<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="monero_confirmation"
                  inherit_id="website_sale.confirmation">
            <xpath expr="." position="inside">
                <script>
                    var btn = document.getElementById('copy_address_button');
                    $('.copy_btn').tooltip({
                        trigger: 'click',
                        placement: 'bottom'
                    });
                    var clipboard = new ClipboardJS(btn);

                    clipboard.on('success', function(e) {
                        $('.copy_btn').tooltip('hide').attr('data-original-title',
                    'Copied payment address!').tooltip('show');
                        setTimeout(function() {
                            $('.copy_btn').tooltip('hide');
                        }, 1000);
                    });

                    clipboard.on('error', function(e) {
                        console.log(e);
                    });
                </script>
<!--                <script>$(document).ready(function() { $.getScript("/monero-rpc-odoo/static/src/js/jquery.qrcode.min.js") });</script>-->
                <script>
                    var show_qr = false;
                </script>
                <script>function enable_qr(uri)
                    {
                    if (show_qr === false) {
                        show_qr = uri
                        jQuery('#qrcode_monero_payment').qrcode(uri);
                        document.getElementById("qr_div1").style.display = "block";
                        document.getElementById("qr_div2").style.display = "block";
                    } else if (show_qr === 0) {
                        document.getElementById("qr_div1").style.display = "block";
                        document.getElementById("qr_div2").style.display = "block";
                    } else {
                        show_qr = 0
                        document.getElementById("qr_div1").style.display = "none";
                        document.getElementById("qr_div2").style.display = "none";
                    }
                    }
                </script>
            </xpath>
            <xpath expr="//*[@class='card mt-3']" position="before">
                <div id="qr_div1" class="card mt-3" style="display:none">
                    <div id="qr_div2" class="card-body" style="display:none">
                        <div id="qrcode_monero_payment"></div>
                    </div>
                </div>
            </xpath>
        </template>


        <template id="monero_payment_confirmation"
                  inherit_id="website_sale.payment_confirmation_status">
            <xpath expr="//*[@class='card-header']" position="inside">
                <script type="text/javascript" src="/monero-rpc-odoo/static/src/js/jquery.qrcode.min.js"></script>
                <t t-if="payment_tx_id.acquirer_id.is_cryptocurrency == True and payment_tx_id.payment_token_id.name and payment_tx_id.state == 'pending'">
                    <p>Payment should be made to the address below:
                        <ul>
                            <b>
                                <li style="clear: both;">
                                    <button id="copy_address_button" class="copy_btn"
                                            name="copy_address_button"
                                            t-att-data-clipboard-text="payment_tx_id.payment_token_id.name"
                                            style="font-size:20px"
                                            title="Copy payment address">
                                        <i class="fa fa-clipboard"></i>
                                    </button>
                                    <a
                                            t-att-href="'monero:%s?tx_amount=%s&amp;tx_description=%s&amp;recipient_name=%s' % (payment_tx_id.payment_token_id.name, payment_tx_id.amount, order.name, order.company_id.name)" target="_blank">
                                        <button id="open_wallet" class="open_btn"
                                            name="open_wallet"
                                            style="font-size:20px"
                                            title="Open with Monero Wallet">
                                            <i class="fa fa-external-link"></i>
                                        </button>
                                    </a>
                                    <button id="show_qr" class="show_qr"
                                            name="show_qr" style="font-size:20px"
                                            title="Show QR Code"
                                            t-attf-onclick="enable_qr('{{payment_tx_id.payment_token_id.name}}')">
                                        <i class="fa fa-qrcode"></i>
                                    </button>
                                    <div id="monero_payment_address">
                                       <t t-raw="payment_tx_id.payment_token_id.name"/>
                                    </div>
                                </li>
                            </b>
                        </ul>
                    </p>
                </t>
            </xpath>
        </template>

    </data>
</odoo>
