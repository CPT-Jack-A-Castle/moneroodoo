<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <template id="monero_payment_confirmation"
                  inherit_id="website_sale.payment_confirmation_status">
            <xpath expr="//*[@class='card-header']" position="inside">
                <script>
                    var btn = document.getElementById('copy_address_button');
                    $('.copy_btn').tooltip({
                        trigger: 'click',
                        placement: 'bottom'
                    });
                    var clipboard = new ClipboardJS(btn);

                    clipboard.on('success', function(e) {
                        $('.copy_btn').tooltip('hide').attr('data-original-title',
                    'Copied payment address!').tooltip('show');
                        setTimeout(function() {
                            $('.copy_btn').tooltip('hide');
                        }, 1000);
                    });

                    clipboard.on('error', function(e) {
                        console.log(e);
                    });
                </script>
                <t t-if="payment_tx_id.acquirer_id.is_cryptocurrency == True and payment_tx_id.payment_token_id.name and payment_tx_id.state == 'pending'">
                    <p>Payment should be made to the address below:
                        <ul>
                            <b>
                                <li style="clear: both;">
                                    <button id="copy_address_button" class="copy_btn"
                                            name="copy_address_button"
                                            t-att-data-clipboard-text="payment_tx_id.payment_token_id.name"
                                            style="font-size:20px"
                                            title="Copy payment address">
                                        <i class="fa fa-clipboard"></i>
                                    </button>
                                    <a
                                            t-att-href="'monero:%s?tx_amount=%s' % (payment_tx_id.payment_token_id.name, payment_tx_id.amount)" target="_blank">
                                        <button id="open_wallet" class="open_btn"
                                            name="open_wallet"
                                            style="font-size:20px"
                                            title="Open with Monero Wallet">
                                            <i class="fa fa-external-link"></i>
                                        </button>
                                    </a>

                                    <t t-raw="payment_tx_id.payment_token_id.name"/>
                                </li>
                            </b>
                        </ul>
                    </p>
                </t>
                <!--    TODO add qrcode: accept the payment via their mobile wallet https://taiga.getmonero.org/project/t-900-monero-x-odoo-integrations/us/31        -->
            </xpath>
        </template>

    </data>
</odoo>
